= kubernetes 소개
:image-url1: https://cdn.jsdelivr.net/gh/jeon3029/learning_container@master/kube/img/img1_1.png
:image-url2: https://cdn.jsdelivr.net/gh/jeon3029/learning_container@master/kube/img/img1_2.png
:image-url3: https://cdn.jsdelivr.net/gh/jeon3029/learning_container@master/kube/img/img1_3.png

== 소개

====
* 개발자가 운영팀 도움 없이 애플리케이션을 자주, 원하는만큼 배포할 수 있게 해준다.
* 하드웨어 인프라를 추상화하고 데이터센터 전체를 하나의 거대한 컴퓨팅 리소스로 제공한다.
====

== 모놀리스 -> MSA 구조로의 전환

.모놀리스 애플리케이션
* 소소의 강력한 서버 필요
* 애플리케이션의 일부분이 수평확장하기 어려울경우 전체 어플리케이션을 확장할 수 없다.

.마이크로서비스 어플리케이션
* 배포할 수 있는 작은 요소로 분할
* 같은 MS 끼리 Reseful API 또는 AMQP 등으로 통신
* 배포관련 조합이 다양하고 상호 종속 증가해서 구성요소가 많아지면 복잡해 짐
* 라이브러리 디펜덴시 종속성이 충돌할 수 있음

== 컨테이너 기술

.컨테이너 기술로 구성요소 격리
* 동일한 호스트 시스템 내에서 동시에 서로 다른 환경 구성하면서 가상머신에 비해 오버헤드가 훨신 작음
* 다른 프로세스와는 격리되어 있음
* 어떻게 격리되어있을까?
** 각 리눅스 시스템은 초기 구동 시 하나의 네임스페이스가 있음
** 추가 네임스페이스 생성 가능
** 프로세스는 여러 네임스페이스에 속할 수 있음
** cgroups 를 이용새 프로세스별 리소스 사용을 제한
* 도커 : 컨테이너 기술로 가상버신과 거의 동일한 수준의 격리 환경을 제공, 이미지(레이어)로 제공되어 제사용 가능(동일한 레이어를 포함하는 이미지를 실행할 때 특정 레이어만 다운로드 하면 됨)

=== 도커 개념

* 애플리케이션 패키징, 배포, 실행하는 기술

.도커와 가상머신 비교
image::{image-url1}[]

어플리케이션 A/B 가 같은 파일을 공유?
* 읽기 전용 이미지 레이어를 서로 읽어서 그 위에 새로운 쓰기위한 레이어가 만들어 짐.
* 동일한 파일을 읽을 수 있지만 격리되어있음(파일을 덮어쓰면 다른 컨테이너는 모르게 됨)


=== 쿠버네티스 개념

* 소프트웨어 구성요소를 관리하고 비용 효율적으로 개발, 배포할 수 있는 솔루션
* 컨테이너화 된 애플리케이션을 쉽게 배포하고 관리할 수 있음
** 구글에서 개발된 보그시스템을 오픈소스화 함


=== 아키텍쳐의 이해

* 마스터노드 : 전체 쿠베 시스템을 제어하고 관리. kubectl 을 실행
* 워커노드 : 실제 배포되는 컨테이너 어플리케이션을 실행

image::{image-url2}[]

.컨트롤 플레인
* 클러스터를 제어하고 작동
* 하나의 마스터 노드에서 실행하거나 여러 노드로 분할 됨
* API : 사용자, 컨트롤 플레인 구성요소와 통신
* 스케쥴러 : 배포 담당
* 매니저 : 워커노드 추적, 노드 장애처리 등
* etcd : 지속적으로 클러스터 구성을 저장하는 신뢰할 수 있는 분산 데이터 저장소

.노드
* 애플리케이션을 실행하는 시스템
* 컨테이너 런타임 : 컨테이너 이미지를 실행
* kubelet : api 서버와 통신하고 노드의 컨테이너를 관리
* kube-proxy : 구성 요소간 네트워크 트래픽을 로드 밸런싱

=== 디스크립션으로 컨테이너를 실행

* API 서버가 애플리케이션 디스크립션을 처리할 때 스케줄러는 각 컨테이너에 필요한 리소스를 계산하고 해당 시점에 각 노드에 할당되지 않은 리소스를 기반으로 사용 가능한 워커노드에 지정된 컨테이너를 할당

image::{image-url3}[]

* 애플리케이션이 실행되면 쿠버네티스는 애플리케이션의 배포 상태가 사용자가 제공한 디스크립션과 일치하는지 지속적으로 확인
** 인스턴스가 제대로 동작하지 않으면 자동으로 재시작


== 요약

====
* 모놀리스 애플리케이션은 구촉하기 쉽지만 시간이 지남에 따라 유지 관리하기가 더 어려워지고 때로는 확장이 불가능할 수 있다.
* 마이크로서비스 기반 애플리케이션 아키텍처는 각 구성 요소의 개발을 용이하게 하지만 하나의 시스템으로 작동하도록 배포하고 구성하기가 어렵다.
* 리눅스 컨테이너는 가상머신과 동일한 이점을 제공하지만 훨씬 더 가볍고 하드웨어 활용도를 높일 수 있다.
* 도커는 OS 환경와 함께 컨테이너화된 애플리케이션을 좀 더 쉽고 빠르게 프로비저닝할 수 있도록 지원해 주는 리눅스 컨테이너 기술을 개선했다.
* 쿠버네티스는 전체 데이터 센터를 애플리케이션 실행을 위한 컴퓨팅 리소스로 제공한다.
* 개발자는 시스템 관리자의 도움 없이도 쿠버네티스로 애플리케이션을 배포할 수 있다.
* 시스템 관리자는 쿠버네티스가 고장 난 노드를 자동으로 처리하도록 함으로써 더 편하게 잠을 잘 수 있다.
====